<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title>Show items</title>    
    <script src="superfetch2.js"></script>
    <style src="style.css" rel="stylesheet"></style>
</head>

<body>
    
    <div id="box1">
        
            <h3 id="add">Add another item: </h3>
            <input id="amount" placeholder="Amount" />
            <input id="itemname" placeholder="Item" />
            <input id="itemdescription" placeholder="Description" />
            <button id="btncreate">Add</button>
    </div>
</body>

<script> 
    
    var inpamount = document.getElementById("amount");
    var inpitemname = document.getElementById("itemname");
    var inpitemdesc = document.getElementById("itemdescription");
    var btncreate = document.getElementById("btncreate");
    
    btncreate.onclick = createItem;
    
    var logindata = JSON.parse(localStorage.getItem("logindata"));
    
    function createItem() {
        
        var upload = JSON.stringify({
            amount: inpamount.value, 
            itemname: inpitemname.value,
            itemdescription: inpitemdesc.value
                       
        });
        
        var fetchSettings = {
            method: "POST",
            body: upload
        }
        
        var url = "http://localhost:3000/listitems/?token=" + logindata.token;
        //var url = "http://localhost:3000/listitems/";
        superfetch(url, "json", succ, error, fetchSettings);   
    }
    
    let object = JSON.parse(localStorage.getItem("logindata"));
    
    var url = "http://localhost:3000/listitems/?token=" + object.token;
    
    //console.log(object.token);
   
    //superfetch(url, "json", succ, error);
    
    
    //success --------------------------------------
    function succ(data) {
        
        if(logindata) {
            
            localStorage.setItem("itemdata", JSON.stringify(data));
            //window.location.href = "showlists.html";
            
        }
        else{
            console.log(data);
        }
        
        
    }
        
        
    //success --------------------------------------
    function succ(data) {
        
    for (var i = 0; i < data.length; i++) {
        var div = document.createElement("div");
        div.innerHTML += "<h3>" + data[i].amount + "</h3>";
        div.innerHTML += "<h3>" + data[i].itemname + "</h3>"; 
        div.innerHTML += "<h3>" + data[i].itemdescription + "</h3>"; 
        
        document.body.appendChild(div);
        
    }
}
    
    //error ----------------------------------------
    function error(err) {
        console.log(err);
    } 
    
</script>

</html>